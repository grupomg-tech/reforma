[
  {
    "tipo": "inline",
    "index": 0,
    "conteudo": "\n        // Elementos do DOM\n        const forgotPasswordLink = document.getElementById('forgotPasswordLink');\n        const resetPasswordModal = document.getElementById('resetPasswordModal');\n        const closeModal = document.getElementById('closeModal');\n        const resetPasswordForm = document.getElementById('resetPasswordForm');\n        const loginForm = document.getElementById('loginForm');\n        const loginBtn = document.getElementById('loginBtn');\n        const loginBtnText = document.getElementById('loginBtnText');\n        const resetBtn = document.getElementById('resetBtn');\n        const resetBtnText = document.getElementById('resetBtnText');\n        const logo = document.getElementById('logo');\n\n        // Abrir modal de redefinir senha\n        forgotPasswordLink.addEventListener('click', function(e) {\n            e.preventDefault();\n            resetPasswordModal.style.display = 'block';\n        });\n\n        // Fechar modal\n        closeModal.addEventListener('click', function() {\n            resetPasswordModal.style.display = 'none';\n            resetPasswordForm.reset();\n        });\n\n        // Fechar modal clicando fora\n        window.addEventListener('click', function(e) {\n            if (e.target === resetPasswordModal) {\n                resetPasswordModal.style.display = 'none';\n                resetPasswordForm.reset();\n            }\n        });\n\n        // Handle do formul√°rio de login\n        loginForm.addEventListener('submit', function(e) {\n            loginBtn.disabled = true;\n            loginBtnText.innerHTML = '<div class=\"loading\"></div>';\n            \n            // Em um cen√°rio real, o Django processar√° o formul√°rio\n            // Aqui simulamos um delay para mostrar o loading\n            setTimeout(() => {\n                loginBtn.disabled = false;\n                loginBtnText.textContent = 'Entrar';\n            }, 2000);\n        });\n\n        // Handle do formul√°rio de redefinir senha\n        resetPasswordForm.addEventListener('submit', function(e) {\n            e.preventDefault();\n            \n            const email = document.getElementById('resetEmail').value;\n            \n            if (!email) {\n                alert('Por favor, digite seu email.');\n                return;\n            }\n\n            resetBtn.disabled = true;\n            resetBtnText.innerHTML = '<div class=\"loading\"></div>';\n\n            // Simula√ß√£o de requisi√ß√£o AJAX para o Django\n            // Em produ√ß√£o, voc√™ faria uma requisi√ß√£o real para sua view\n            fetch('/accounts/reset-password/', {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json',\n                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value\n                },\n                body: JSON.stringify({\n                    email: email\n                })\n            })\n            .then(response => response.json())\n            .then(data => {\n                resetBtn.disabled = false;\n                resetBtnText.textContent = 'Enviar Instru√ß√µes';\n                \n                if (data.success) {\n                    alert('Instru√ß√µes enviadas para seu email!');\n                    resetPasswordModal.style.display = 'none';\n                    resetPasswordForm.reset();\n                } else {\n                    alert(data.message || 'Email n√£o encontrado. Verifique se voc√™ j√° possui uma conta.');\n                }\n            })\n            .catch(error => {\n                resetBtn.disabled = false;\n                resetBtnText.textContent = 'Enviar Instru√ß√µes';\n                alert('Erro ao processar solicita√ß√£o. Tente novamente.');\n            });\n        });\n\n        // Fallback para logo caso n√£o carregue\n        logo.addEventListener('error', function() {\n            this.style.display = 'none';\n        });\n\n        // Anima√ß√£o de entrada\n        document.addEventListener('DOMContentLoaded', function() {\n            const container = document.querySelector('.login-container');\n            container.style.opacity = '0';\n            container.style.transform = 'translateY(30px)';\n            \n            setTimeout(() => {\n                container.style.transition = 'all 0.6s ease';\n                container.style.opacity = '1';\n                container.style.transform = 'translateY(0)';\n            }, 100);\n        });\n\n        // Tecla Enter para submeter formul√°rios\n        document.addEventListener('keypress', function(e) {\n            if (e.key === 'Enter') {\n                if (resetPasswordModal.style.display === 'block') {\n                    resetPasswordForm.dispatchEvent(new Event('submit'));\n                }\n            }\n        });\n    "
  },
  {
    "tipo": "inline",
    "index": 0,
    "conteudo": "\n        // Elementos do DOM\n        const forgotPasswordLink = document.getElementById('forgotPasswordLink');\n        const resetPasswordModal = document.getElementById('resetPasswordModal');\n        const closeModal = document.getElementById('closeModal');\n        const resetPasswordForm = document.getElementById('resetPasswordForm');\n        const loginForm = document.getElementById('loginForm');\n        const loginBtn = document.getElementById('loginBtn');\n        const loginBtnText = document.getElementById('loginBtnText');\n        const resetBtn = document.getElementById('resetBtn');\n        const resetBtnText = document.getElementById('resetBtnText');\n        const logo = document.getElementById('logo');\n\n        // Abrir modal de redefinir senha\n        forgotPasswordLink.addEventListener('click', function(e) {\n            e.preventDefault();\n            resetPasswordModal.style.display = 'block';\n        });\n\n        // Fechar modal\n        closeModal.addEventListener('click', function() {\n            resetPasswordModal.style.display = 'none';\n            resetPasswordForm.reset();\n        });\n\n        // Fechar modal clicando fora\n        window.addEventListener('click', function(e) {\n            if (e.target === resetPasswordModal) {\n                resetPasswordModal.style.display = 'none';\n                resetPasswordForm.reset();\n            }\n        });\n\n        // Handle do formul√°rio de login\n        loginForm.addEventListener('submit', function(e) {\n            loginBtn.disabled = true;\n            loginBtnText.innerHTML = '<div class=\"loading\"></div>';\n            \n            // Em um cen√°rio real, o Django processar√° o formul√°rio\n            // Aqui simulamos um delay para mostrar o loading\n            setTimeout(() => {\n                loginBtn.disabled = false;\n                loginBtnText.textContent = 'Entrar';\n            }, 2000);\n        });\n\n        // Handle do formul√°rio de redefinir senha\n        resetPasswordForm.addEventListener('submit', function(e) {\n            e.preventDefault();\n            \n            const email = document.getElementById('resetEmail').value;\n            \n            if (!email) {\n                alert('Por favor, digite seu email.');\n                return;\n            }\n\n            resetBtn.disabled = true;\n            resetBtnText.innerHTML = '<div class=\"loading\"></div>';\n\n            // Simula√ß√£o de requisi√ß√£o AJAX para o Django\n            // Em produ√ß√£o, voc√™ faria uma requisi√ß√£o real para sua view\n            fetch('/accounts/reset-password/', {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json',\n                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value\n                },\n                body: JSON.stringify({\n                    email: email\n                })\n            })\n            .then(response => response.json())\n            .then(data => {\n                resetBtn.disabled = false;\n                resetBtnText.textContent = 'Enviar Instru√ß√µes';\n                \n                if (data.success) {\n                    alert('Instru√ß√µes enviadas para seu email!');\n                    resetPasswordModal.style.display = 'none';\n                    resetPasswordForm.reset();\n                } else {\n                    alert(data.message || 'Email n√£o encontrado. Verifique se voc√™ j√° possui uma conta.');\n                }\n            })\n            .catch(error => {\n                resetBtn.disabled = false;\n                resetBtnText.textContent = 'Enviar Instru√ß√µes';\n                alert('Erro ao processar solicita√ß√£o. Tente novamente.');\n            });\n        });\n\n        // Fallback para logo caso n√£o carregue\n        logo.addEventListener('error', function() {\n            this.style.display = 'none';\n        });\n\n        // Anima√ß√£o de entrada\n        document.addEventListener('DOMContentLoaded', function() {\n            const container = document.querySelector('.login-container');\n            container.style.opacity = '0';\n            container.style.transform = 'translateY(30px)';\n            \n            setTimeout(() => {\n                container.style.transition = 'all 0.6s ease';\n                container.style.opacity = '1';\n                container.style.transform = 'translateY(0)';\n            }, 100);\n        });\n\n        // Tecla Enter para submeter formul√°rios\n        document.addEventListener('keypress', function(e) {\n            if (e.key === 'Enter') {\n                if (resetPasswordModal.style.display === 'block') {\n                    resetPasswordForm.dispatchEvent(new Event('submit'));\n                }\n            }\n        });\n    "
  },
  {
    "tipo": "inline",
    "index": 0,
    "conteudo": "\n    document.addEventListener('DOMContentLoaded', function () {\n        const form = document.getElementById('exportarSpedForm');\n\n        // Campos\n        const radiosTipo = document.querySelectorAll('input[name=\"tipo\"]');\n        const selectEmpresa = document.getElementById('id_empresa');\n        const selectPeriodoInicial = document.getElementById('id_periodo_inicial');\n        const selectPeriodoFinal = document.getElementById('id_periodo_final');\n        const checkboxTodos = document.getElementById('id_selecionar_todos');\n\n        /* ===============================\n        üîÑ CONTROLE DOS PER√çODOS\n        =============================== */\n\n        function togglePeriodos() {\n            const disabled = checkboxTodos.checked;\n            selectPeriodoInicial.disabled = disabled;\n            selectPeriodoFinal.disabled = disabled;\n        }\n\n        checkboxTodos.addEventListener('change', togglePeriodos);\n        togglePeriodos();\n\n        /* ===============================\n        üîÑ CARREGAR EMPRESAS\n        =============================== */\n\n        function carregarEmpresas(tipo) {\n            fetch(`/carregar-empresas/?tipo=${tipo}`)\n                .then(res => res.json())\n                .then(data => {\n                    selectEmpresa.innerHTML = '';\n                    selectEmpresa.add(new Option('-- Selecione a empresa --', ''));\n\n                    data.empresas.forEach(emp => {\n                        selectEmpresa.add(new Option(emp.label, emp.value));\n                    });\n\n                    // Limpa per√≠odos ao trocar tipo\n                    limparPeriodos();\n                })\n                .catch(err => console.error('Erro ao carregar empresas:', err));\n        }\n\n        /* ===============================\n        üîÑ CARREGAR PER√çODOS\n        =============================== */\n\n        function carregarPeriodos() {\n            const tipo = document.querySelector('input[name=\"tipo\"]:checked')?.value;\n            const empresa = selectEmpresa.value;\n\n            if (!tipo || !empresa) return;\n\n            fetch(`/carregar-periodos/?tipo=${tipo}&empresa=${empresa}`)\n                .then(res => res.json())\n                .then(data => {\n                    selectPeriodoInicial.innerHTML = '';\n                    selectPeriodoFinal.innerHTML = '';\n\n                    selectPeriodoInicial.add(new Option('-- Selecione --', ''));\n                    selectPeriodoFinal.add(new Option('-- Selecione --', ''));\n\n                    data.choices.forEach(c => {\n                        selectPeriodoInicial.add(new Option(c.label, c.value));\n                        selectPeriodoFinal.add(new Option(c.label, c.value));\n                    });\n                })\n                .catch(err => console.error('Erro ao carregar per√≠odos:', err));\n        }\n\n        function limparPeriodos() {\n            selectPeriodoInicial.innerHTML = '';\n            selectPeriodoFinal.innerHTML = '';\n            selectPeriodoInicial.add(new Option('-- Selecione --', ''));\n            selectPeriodoFinal.add(new Option('-- Selecione --', ''));\n        }\n\n        /* ===============================\n        üéØ EVENTOS\n        =============================== */\n\n        radiosTipo.forEach(radio => {\n            radio.addEventListener('change', function () {\n                carregarEmpresas(this.value);\n            });\n        });\n\n        selectEmpresa.addEventListener('change', carregarPeriodos);\n\n    });\n"
  },
  {
    "tipo": "inline",
    "index": 1,
    "conteudo": "\n        // --- 1. L√≥gica para carregar Toasts na inicializa√ß√£o ---\n        //const toastElList = [].slice.call(document.querySelectorAll('.toast'));\n        //const toastList = toastElList.map(function(toastEl) {\n            // Cria uma inst√¢ncia do Toast e a exibe\n        //    const toast = new bootstrap.Toast(toastEl);\n        //    toast.show();\n        //    return toast;\n        //});\n\n        // Sidebar functionality\n        const sidebar = document.getElementById('sidebar');\n        const mainContent = document.getElementById('mainContent');\n        const toggleBtn = document.getElementById('toggleSidebar');\n        const toggleIcon = document.getElementById('toggleIcon');\n        const mobileOverlay = document.getElementById('mobileOverlay');\n        \n        let isCollapsed = false;\n        let isMobile = window.innerWidth <= 768;\n\n        // Toggle sidebar\n        function toggleSidebar() {\n            if (isMobile) {\n                sidebar.classList.toggle('show');\n                mobileOverlay.classList.toggle('show');\n            } else {\n                isCollapsed = !isCollapsed;\n                sidebar.classList.toggle('collapsed');\n                mainContent.classList.toggle('expanded');\n                toggleIcon.className = isCollapsed ? 'bi bi-chevron-right' : 'bi bi-chevron-left';\n                \n                // Close all dropdowns when collapsing\n                if (isCollapsed) {\n                    document.querySelectorAll('.submenu.show').forEach(submenu => {\n                        submenu.classList.remove('show');\n                    });\n                    document.querySelectorAll('.menu-arrow.rotated').forEach(arrow => {\n                        arrow.classList.remove('rotated');\n                    });\n                }\n            }\n        }\n\n        toggleBtn.addEventListener('click', toggleSidebar);\n        mobileOverlay.addEventListener('click', toggleSidebar);\n\n        // Dropdown functionality\n        document.querySelectorAll('[data-toggle]').forEach(link => {\n            link.addEventListener('click', function(e) {\n                e.preventDefault();\n                \n                if (isCollapsed && !isMobile) return;\n                \n                const target = this.getAttribute('data-toggle');\n                const submenu = document.getElementById(target + '-submenu');\n                const arrow = this.querySelector('.menu-arrow');\n                \n                // Close other dropdowns\n                document.querySelectorAll('.submenu.show').forEach(otherSubmenu => {\n                    if (otherSubmenu !== submenu) {\n                        otherSubmenu.classList.remove('show');\n                    }\n                });\n                \n                document.querySelectorAll('.menu-arrow.rotated').forEach(otherArrow => {\n                    if (otherArrow !== arrow) {\n                        otherArrow.classList.remove('rotated');\n                    }\n                });\n                \n                // Toggle current dropdown\n                submenu.classList.toggle('show');\n                arrow.classList.toggle('rotated');\n                \n                // Set active state\n                document.querySelectorAll('.menu-link.active').forEach(activeLink => {\n                    activeLink.classList.remove('active');\n                });\n                this.classList.add('active');\n            });\n        });\n\n        // User menu functionality\n        const userProfile = document.getElementById('userProfile');\n        const userMenu = document.getElementById('userMenu');\n        \n        userProfile.addEventListener('click', function(e) {\n            e.stopPropagation();\n            userMenu.classList.toggle('show');\n        });\n\n        // Close user menu when clicking outside\n        document.addEventListener('click', function() {\n            userMenu.classList.remove('show');\n        });\n\n        // Password toggle functionality\n        function togglePassword(fieldId) {\n            const field = document.getElementById(fieldId);\n            const icon = document.getElementById(fieldId + '_icon');\n            \n            if (field.type === 'password') {\n                field.type = 'text';\n                icon.className = 'bi bi-eye-slash';\n            } else {\n                field.type = 'password';\n                icon.className = 'bi bi-eye';\n            }\n        }\n\n        // Form validation\n        document.getElementById('profileForm').addEventListener('submit', function(e) {\n            const newPassword = document.getElementById('new_password').value;\n            const confirmPassword = document.getElementById('confirm_password').value;\n            const currentPassword = document.getElementById('current_password').value;\n            \n            // Only validate password if user is trying to change it\n            if (newPassword || confirmPassword) {\n                if (!currentPassword) {\n                    e.prevent"
  },
  {
    "tipo": "externo",
    "src": "https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
  },
  {
    "tipo": "inline",
    "index": 1,
    "conteudo": "\n    document.addEventListener('DOMContentLoaded', function () {\n        const form = document.getElementById('deleteSpedForm');\n\n        // Modal\n        const btnDelete = document.getElementById('btnDelete');\n        const modal = document.getElementById('confirmModal');\n        const btnCancel = document.getElementById('btnCancel');\n        const btnConfirm = document.getElementById('btnConfirm');\n\n        // Campos\n        const radiosTipo = document.querySelectorAll('input[name=\"tipo\"]');\n        const selectEmpresa = document.getElementById('id_empresa');\n        const selectPeriodoInicial = document.getElementById('id_periodo_inicial');\n        const selectPeriodoFinal = document.getElementById('id_periodo_final');\n        const checkboxTodos = document.getElementById('id_selecionar_todos');\n\n        /* ===============================\n        üîÑ CONTROLE DOS PER√çODOS\n        =============================== */\n\n        function togglePeriodos() {\n            const disabled = checkboxTodos.checked;\n            selectPeriodoInicial.disabled = disabled;\n            selectPeriodoFinal.disabled = disabled;\n        }\n\n        checkboxTodos.addEventListener('change', togglePeriodos);\n        togglePeriodos();\n\n        /* ===============================\n        üîÑ CARREGAR EMPRESAS\n        =============================== */\n\n        function carregarEmpresas(tipo) {\n            fetch(`/carregar-empresas/?tipo=${tipo}`)\n                .then(res => res.json())\n                .then(data => {\n                    selectEmpresa.innerHTML = '';\n                    selectEmpresa.add(new Option('-- Selecione a empresa --', ''));\n\n                    data.empresas.forEach(emp => {\n                        selectEmpresa.add(new Option(emp.label, emp.value));\n                    });\n\n                    // Limpa per√≠odos ao trocar tipo\n                    limparPeriodos();\n                })\n                .catch(err => console.error('Erro ao carregar empresas:', err));\n        }\n\n        /* ===============================\n        üîÑ CARREGAR PER√çODOS\n        =============================== */\n\n        function carregarPeriodos() {\n            const tipo = document.querySelector('input[name=\"tipo\"]:checked')?.value;\n            const empresa = selectEmpresa.value;\n\n            if (!tipo || !empresa) return;\n\n            fetch(`/carregar-periodos/?tipo=${tipo}&empresa=${empresa}`)\n                .then(res => res.json())\n                .then(data => {\n                    selectPeriodoInicial.innerHTML = '';\n                    selectPeriodoFinal.innerHTML = '';\n\n                    selectPeriodoInicial.add(new Option('-- Selecione --', ''));\n                    selectPeriodoFinal.add(new Option('-- Selecione --', ''));\n\n                    data.choices.forEach(c => {\n                        selectPeriodoInicial.add(new Option(c.label, c.value));\n                        selectPeriodoFinal.add(new Option(c.label, c.value));\n                    });\n                })\n                .catch(err => console.error('Erro ao carregar per√≠odos:', err));\n        }\n\n        function limparPeriodos() {\n            selectPeriodoInicial.innerHTML = '';\n            selectPeriodoFinal.innerHTML = '';\n            selectPeriodoInicial.add(new Option('-- Selecione --', ''));\n            selectPeriodoFinal.add(new Option('-- Selecione --', ''));\n        }\n\n        /* ===============================\n        üéØ EVENTOS\n        =============================== */\n\n        radiosTipo.forEach(radio => {\n            radio.addEventListener('change', function () {\n                carregarEmpresas(this.value);\n            });\n        });\n\n        selectEmpresa.addEventListener('change', carregarPeriodos);\n\n        /* ===============================\n        üóëÔ∏è MODAL DE CONFIRMA√á√ÉO\n        =============================== */\n\n        btnDelete.addEventListener('click', () => {\n            modal.style.display = 'flex';\n        });\n\n        btnCancel.addEventListener('click', () => {\n            modal.style.display = 'none';\n        });\n\n        modal.addEventListener('click', e => {\n            if (e.target === modal) {\n                modal.style.display = 'none';\n            }\n        });\n\n        btnConfirm.addEventListener('click', () => {\n            modal.style.display = 'none';\n            form.submit();\n        });\n\n        document.addEventListener('keydown', e => {\n            if (e.key === 'Escape' && modal.style.display === 'flex') {\n                modal.style.display = 'none';\n            }\n        });\n\n    });\n"
  },
  {
    "tipo": "inline",
    "index": 2,
    "conteudo": "\n        // --- 1. L√≥gica para carregar Toasts na inicializa√ß√£o ---\n        //const toastElList = [].slice.call(document.querySelectorAll('.toast'));\n        //const toastList = toastElList.map(function(toastEl) {\n            // Cria uma inst√¢ncia do Toast e a exibe\n        //    const toast = new bootstrap.Toast(toastEl);\n        //    toast.show();\n        //    return toast;\n        //});\n\n        // Sidebar functionality\n        const sidebar = document.getElementById('sidebar');\n        const mainContent = document.getElementById('mainContent');\n        const toggleBtn = document.getElementById('toggleSidebar');\n        const toggleIcon = document.getElementById('toggleIcon');\n        const mobileOverlay = document.getElementById('mobileOverlay');\n        \n        let isCollapsed = false;\n        let isMobile = window.innerWidth <= 768;\n\n        // Toggle sidebar\n        function toggleSidebar() {\n            if (isMobile) {\n                sidebar.classList.toggle('show');\n                mobileOverlay.classList.toggle('show');\n            } else {\n                isCollapsed = !isCollapsed;\n                sidebar.classList.toggle('collapsed');\n                mainContent.classList.toggle('expanded');\n                toggleIcon.className = isCollapsed ? 'bi bi-chevron-right' : 'bi bi-chevron-left';\n                \n                // Close all dropdowns when collapsing\n                if (isCollapsed) {\n                    document.querySelectorAll('.submenu.show').forEach(submenu => {\n                        submenu.classList.remove('show');\n                    });\n                    document.querySelectorAll('.menu-arrow.rotated').forEach(arrow => {\n                        arrow.classList.remove('rotated');\n                    });\n                }\n            }\n        }\n\n        toggleBtn.addEventListener('click', toggleSidebar);\n        mobileOverlay.addEventListener('click', toggleSidebar);\n\n        // Dropdown functionality\n        document.querySelectorAll('[data-toggle]').forEach(link => {\n            link.addEventListener('click', function(e) {\n                e.preventDefault();\n                \n                if (isCollapsed && !isMobile) return;\n                \n                const target = this.getAttribute('data-toggle');\n                const submenu = document.getElementById(target + '-submenu');\n                const arrow = this.querySelector('.menu-arrow');\n                \n                // Close other dropdowns\n                document.querySelectorAll('.submenu.show').forEach(otherSubmenu => {\n                    if (otherSubmenu !== submenu) {\n                        otherSubmenu.classList.remove('show');\n                    }\n                });\n                \n                document.querySelectorAll('.menu-arrow.rotated').forEach(otherArrow => {\n                    if (otherArrow !== arrow) {\n                        otherArrow.classList.remove('rotated');\n                    }\n                });\n                \n                // Toggle current dropdown\n                submenu.classList.toggle('show');\n                arrow.classList.toggle('rotated');\n                \n                // Set active state\n                document.querySelectorAll('.menu-link.active').forEach(activeLink => {\n                    activeLink.classList.remove('active');\n                });\n                this.classList.add('active');\n            });\n        });\n\n        // User menu functionality\n        const userProfile = document.getElementById('userProfile');\n        const userMenu = document.getElementById('userMenu');\n        \n        userProfile.addEventListener('click', function(e) {\n            e.stopPropagation();\n            userMenu.classList.toggle('show');\n        });\n\n        // Close user menu when clicking outside\n        document.addEventListener('click', function() {\n            userMenu.classList.remove('show');\n        });\n\n        // Password toggle functionality\n        function togglePassword(fieldId) {\n            const field = document.getElementById(fieldId);\n            const icon = document.getElementById(fieldId + '_icon');\n            \n            if (field.type === 'password') {\n                field.type = 'text';\n                icon.className = 'bi bi-eye-slash';\n            } else {\n                field.type = 'password';\n                icon.className = 'bi bi-eye';\n            }\n        }\n\n        // Form validation\n        document.getElementById('profileForm').addEventListener('submit', function(e) {\n            const newPassword = document.getElementById('new_password').value;\n            const confirmPassword = document.getElementById('confirm_password').value;\n            const currentPassword = document.getElementById('current_password').value;\n            \n            // Only validate password if user is trying to change it\n            if (newPassword || confirmPassword) {\n                if (!currentPassword) {\n                    e.prevent"
  },
  {
    "tipo": "inline",
    "index": 0,
    "conteudo": "\n    // ========== VARI√ÅVEIS GLOBAIS ==========\n    let taskId = null;\n    let historicoId = null;\n    let pollingInterval = null;\n    let startTime = null;\n\n    // ========== ELEMENTOS DO DOM ==========\n    const form = document.getElementById('form-importacao');\n    const submitBtn = document.getElementById('btn-submit');\n    const modalOverlay = document.getElementById('modalImportacao');\n    const selectEmpresa = document.getElementById('id_empresa');\n    const selectSped = document.getElementById('id_sped');\n    const selectPeriodo = document.getElementById('id_periodos');\n\n    // ========== FUN√á√ïES DO MODAL ==========\n    function showModal() {\n        modalOverlay?.classList.add('show');\n        document.body.style.overflow = 'hidden';\n    }\n\n    function fecharModal() {\n        modalOverlay?.classList.remove('show');\n        document.body.style.overflow = '';\n        resetarEstadoModal();\n    }\n\n    function resetarEstadoModal() {\n        document.getElementById('estado-processando').style.display = 'block';\n        document.getElementById('estado-resultado').classList.remove('show');\n        document.getElementById('progress-bar').style.width = '0%';\n        document.getElementById('progress-percentage').textContent = '0%';\n        document.getElementById('progress-status').textContent = 'Iniciando...';\n        document.getElementById('progress-count').textContent = '0 de 0 arquivos';\n        \n        if (pollingInterval) {\n            clearInterval(pollingInterval);\n            pollingInterval = null;\n        }\n    }\n\n    function abrirModalHistorico() {\n        trocarTab('historico');\n        showModal();\n        carregarHistorico();\n    }\n\n    // ========== FUN√á√ïES DAS TABS ==========\n    function trocarTab(tabName) {\n        document.querySelectorAll('.modal-tab').forEach(tab => {\n            tab.classList.toggle('active', tab.dataset.tab === tabName);\n        });\n        document.querySelectorAll('.tab-content').forEach(content => {\n            content.classList.toggle('active', content.id === 'tab-' + tabName);\n        });\n    }\n\n    // ========== SUBMIT DO FORMUL√ÅRIO ==========\n    form?.addEventListener('submit', async function(e) {\n        e.preventDefault();\n        \n        submitBtn.classList.add('btn-loading');\n        submitBtn.disabled = true;\n        \n        const formData = new FormData(form);\n        \n        try {\n            const response = await fetch(form.action || window.location.href, {\n                method: 'POST',\n                body: formData,\n                headers: {\n                    'X-Requested-With': 'XMLHttpRequest'\n                }\n            });\n            \n            const data = await response.json();\n            \n            if (data.success) {\n                taskId = data.task_id;\n                historicoId = data.historico_id;\n                startTime = Date.now();\n                \n                trocarTab('progresso');\n                showModal();\n                iniciarPolling();\n            } else {\n                mostrarErros(data.errors);\n            }\n        } catch (error) {\n            console.error('Erro:', error);\n            alert('Erro ao iniciar importa√ß√£o. Tente novamente.');\n        } finally {\n            submitBtn.classList.remove('btn-loading');\n            submitBtn.disabled = false;\n        }\n    });\n\n    // ========== POLLING DO PROGRESSO ==========\n    function iniciarPolling() {\n        if (pollingInterval) clearInterval(pollingInterval);\n        \n        pollingInterval = setInterval(verificarProgresso, 1000);\n        verificarProgresso();\n    }\n\n    async function verificarProgresso() {\n        if (!taskId) return;\n        \n        try {\n            const response = await fetch(`/api/progresso/TASK_ID/`.replace('TASK_ID', taskId));\n            const data = await response.json();\n            \n            atualizarUI(data);\n            \n            if (data.complete) {\n                clearInterval(pollingInterval);\n                pollingInterval = null;\n                mostrarResultado(data.result || data);\n            }\n        } catch (error) {\n            console.error('Erro ao verificar progresso:', error);\n        }\n    }\n\n    function atualizarUI(data) {\n        const progress = data.total > 0 ? Math.round((data.progress / data.total) * 100) : 0;\n        \n        document.getElementById('progress-bar').style.width = progress + '%';\n        document.getElementById('progress-percentage').textContent = progress + '%';\n        document.getElementById('progress-status').textContent = data.status || 'Processando...';\n        document.getElementById('progress-count').textContent = `${data.progress || 0} de ${data.total || 0} arquivos`;\n        \n        // Tempo estimado\n        if (startTime && data.progress > 0 && data.total > 0) {\n            const elapsed = (Date.now() - startTime) / 1000;\n            const rate = data.progress / elapsed;\n            const remaining = (data.total - data.progress) / rate;\n         "
  },
  {
    "tipo": "inline",
    "index": 1,
    "conteudo": "\n        // --- 1. L√≥gica para carregar Toasts na inicializa√ß√£o ---\n        //const toastElList = [].slice.call(document.querySelectorAll('.toast'));\n        //const toastList = toastElList.map(function(toastEl) {\n            // Cria uma inst√¢ncia do Toast e a exibe\n        //    const toast = new bootstrap.Toast(toastEl);\n        //    toast.show();\n        //    return toast;\n        //});\n\n        // Sidebar functionality\n        const sidebar = document.getElementById('sidebar');\n        const mainContent = document.getElementById('mainContent');\n        const toggleBtn = document.getElementById('toggleSidebar');\n        const toggleIcon = document.getElementById('toggleIcon');\n        const mobileOverlay = document.getElementById('mobileOverlay');\n        \n        let isCollapsed = false;\n        let isMobile = window.innerWidth <= 768;\n\n        // Toggle sidebar\n        function toggleSidebar() {\n            if (isMobile) {\n                sidebar.classList.toggle('show');\n                mobileOverlay.classList.toggle('show');\n            } else {\n                isCollapsed = !isCollapsed;\n                sidebar.classList.toggle('collapsed');\n                mainContent.classList.toggle('expanded');\n                toggleIcon.className = isCollapsed ? 'bi bi-chevron-right' : 'bi bi-chevron-left';\n                \n                // Close all dropdowns when collapsing\n                if (isCollapsed) {\n                    document.querySelectorAll('.submenu.show').forEach(submenu => {\n                        submenu.classList.remove('show');\n                    });\n                    document.querySelectorAll('.menu-arrow.rotated').forEach(arrow => {\n                        arrow.classList.remove('rotated');\n                    });\n                }\n            }\n        }\n\n        toggleBtn.addEventListener('click', toggleSidebar);\n        mobileOverlay.addEventListener('click', toggleSidebar);\n\n        // Dropdown functionality\n        document.querySelectorAll('[data-toggle]').forEach(link => {\n            link.addEventListener('click', function(e) {\n                e.preventDefault();\n                \n                if (isCollapsed && !isMobile) return;\n                \n                const target = this.getAttribute('data-toggle');\n                const submenu = document.getElementById(target + '-submenu');\n                const arrow = this.querySelector('.menu-arrow');\n                \n                // Close other dropdowns\n                document.querySelectorAll('.submenu.show').forEach(otherSubmenu => {\n                    if (otherSubmenu !== submenu) {\n                        otherSubmenu.classList.remove('show');\n                    }\n                });\n                \n                document.querySelectorAll('.menu-arrow.rotated').forEach(otherArrow => {\n                    if (otherArrow !== arrow) {\n                        otherArrow.classList.remove('rotated');\n                    }\n                });\n                \n                // Toggle current dropdown\n                submenu.classList.toggle('show');\n                arrow.classList.toggle('rotated');\n                \n                // Set active state\n                document.querySelectorAll('.menu-link.active').forEach(activeLink => {\n                    activeLink.classList.remove('active');\n                });\n                this.classList.add('active');\n            });\n        });\n\n        // User menu functionality\n        const userProfile = document.getElementById('userProfile');\n        const userMenu = document.getElementById('userMenu');\n        \n        userProfile.addEventListener('click', function(e) {\n            e.stopPropagation();\n            userMenu.classList.toggle('show');\n        });\n\n        // Close user menu when clicking outside\n        document.addEventListener('click', function() {\n            userMenu.classList.remove('show');\n        });\n\n        // Password toggle functionality\n        function togglePassword(fieldId) {\n            const field = document.getElementById(fieldId);\n            const icon = document.getElementById(fieldId + '_icon');\n            \n            if (field.type === 'password') {\n                field.type = 'text';\n                icon.className = 'bi bi-eye-slash';\n            } else {\n                field.type = 'password';\n                icon.className = 'bi bi-eye';\n            }\n        }\n\n        // Form validation\n        document.getElementById('profileForm').addEventListener('submit', function(e) {\n            const newPassword = document.getElementById('new_password').value;\n            const confirmPassword = document.getElementById('confirm_password').value;\n            const currentPassword = document.getElementById('current_password').value;\n            \n            // Only validate password if user is trying to change it\n            if (newPassword || confirmPassword) {\n                if (!currentPassword) {\n                    e.prevent"
  },
  {
    "tipo": "externo",
    "src": "https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"
  },
  {
    "tipo": "inline",
    "index": 1,
    "conteudo": "\n        // Vari√°veis globais\n        let tipoDocumentoAtual = 'nfe';\n        let paginaAtual = 1;\n        let totalPaginas = 1;\n\n        //=============================================================================================================\n        //============================================ Fun√ß√µes Utilit√°rias ============================================\n        //=============================================================================================================\n\n        function formatarCPFCNPJ(valor) {\n            const digitos = String(valor).replace(/\\D/g, ''); // Remove tudo que n√£o √© d√≠gito\n\n            if (digitos.length === 11) {\n                // Formato CPF: 000.000.000-00\n                return digitos.replace(/^(\\d{3})(\\d{3})(\\d{3})(\\d{2})$/, '$1.$2.$3-$4');\n            } \n            \n            if (digitos.length === 14) {\n                // Formato CNPJ: 00.000.000/0000-00\n                return digitos.replace(/^(\\d{2})(\\d{3})(\\d{3})(\\d{4})(\\d{2})$/, '$1.$2.$3/$4-$5');\n            }\n\n            // Retorna o valor original se n√£o for nem CPF nem CNPJ\n            return valor;\n        }\n\n        function formatarMoeda(valor) {\n            return new Intl.NumberFormat('pt-BR', {\n                style: 'currency',\n                currency: 'BRL'\n            }).format(valor);\n        }\n\n        function formatarData(data) {\n            return new Date(data).toLocaleDateString('pt-BR');\n        }\n\n        function getStatusBadge(status) {\n            const badges = {\n                'Autorizada': 'success',\n                'Cancelada': 'danger',\n                'Rejeitada': 'warning',\n                'Pendente': 'info'\n            };\n            const tipo = badges[status] || 'secondary';\n            return `<span class=\"badge ${tipo} status-badge\">${status}</span>`;\n        }\n\n        //=============================================================================================================\n        //====================================== Fun√ß√£o para Exibir Relat√≥rio de Importa√ß√£o ===========================\n        //=============================================================================================================\n\n        /**\n         * Exibe o relat√≥rio de importa√ß√£o dentro do modal de importa√ß√£o.\n         * @param {Array} relatorio - Lista de itens do relat√≥rio (ex: [status, mensagem, contexto])\n         * @param {number} sucessos - Contagem de sucessos\n         * @param {number} erros - Contagem de erros\n         */\n        function exibirRelatorioImportacao(sucessos, erros) {\n            console.log(\"Iniciando exibirRelatorioImportacao (vers√£o Resumo)...\"); // Log\n            const container = document.getElementById('import-relatorio-container');\n            const spanSucessos = document.getElementById('relatorio-sucessos');\n            const spanErros = document.getElementById('relatorio-erros');\n            const btnExportar = document.getElementById('btn-exportar-relatorio'); // Novo elemento\n\n            console.log(\"Elemento container encontrado:\", container);\n            console.log(\"Elemento spanSucessos encontrado:\", spanSucessos);\n            console.log(\"Elemento spanErros encontrado:\", spanErros);\n            console.log(\"Elemento btnExportar encontrado:\", btnExportar); // Log do novo bot√£o\n\n            if (!container || !spanSucessos || !spanErros || !btnExportar) {\n                console.error('Elementos do container de relat√≥rio ou bot√£o de exporta√ß√£o n√£o encontrados!');\n                const contentArea = document.getElementById('modalImportarXMLContent');\n                if (contentArea) {\n                    contentArea.innerHTML += '<div class=\"alert alert-warning mt-3\">Erro ao exibir o resumo do relat√≥rio.</div>';\n                }\n                return;\n            }\n\n            // Preenche os contadores\n            spanSucessos.textContent = sucessos;\n            spanErros.textContent = erros;\n\n            // Torna o container principal e o bot√£o de exporta√ß√£o vis√≠veis\n            container.classList.remove('d-none');\n            btnExportar.classList.remove('d-none'); // Mostra o bot√£o!\n\n            console.log(\"exibirRelatorioImportacao (Resumo) conclu√≠do.\"); // Log\n        }\n\n        // Fun√ß√£o para trocar tipo de documento\n        function trocarTipoDocumento(tipo) {\n            tipoDocumentoAtual = tipo;\n            paginaAtual = 1;\n            atualizarFiltrosDisponiveis();\n            carregarDados();\n        }\n\n        // Quando trocar de aba, atualizar filtros dispon√≠veis\n        document.addEventListener('DOMContentLoaded', function() {\n            const tabButtons = document.querySelectorAll('[data-bs-toggle=\"tab\"]');\n            \n            tabButtons.forEach(tab => {\n                tab.addEventListener('shown.bs.tab', function(e) {\n                    const targetTab = e.target.getAttribute('data-bs-target');\n                    \n                    // Atualizar tipo de documento\n                    if (targetTa"
  },
  {
    "tipo": "inline",
    "index": 2,
    "conteudo": "\n        // --- 1. L√≥gica para carregar Toasts na inicializa√ß√£o ---\n        //const toastElList = [].slice.call(document.querySelectorAll('.toast'));\n        //const toastList = toastElList.map(function(toastEl) {\n            // Cria uma inst√¢ncia do Toast e a exibe\n        //    const toast = new bootstrap.Toast(toastEl);\n        //    toast.show();\n        //    return toast;\n        //});\n\n        // Sidebar functionality\n        const sidebar = document.getElementById('sidebar');\n        const mainContent = document.getElementById('mainContent');\n        const toggleBtn = document.getElementById('toggleSidebar');\n        const toggleIcon = document.getElementById('toggleIcon');\n        const mobileOverlay = document.getElementById('mobileOverlay');\n        \n        let isCollapsed = false;\n        let isMobile = window.innerWidth <= 768;\n\n        // Toggle sidebar\n        function toggleSidebar() {\n            if (isMobile) {\n                sidebar.classList.toggle('show');\n                mobileOverlay.classList.toggle('show');\n            } else {\n                isCollapsed = !isCollapsed;\n                sidebar.classList.toggle('collapsed');\n                mainContent.classList.toggle('expanded');\n                toggleIcon.className = isCollapsed ? 'bi bi-chevron-right' : 'bi bi-chevron-left';\n                \n                // Close all dropdowns when collapsing\n                if (isCollapsed) {\n                    document.querySelectorAll('.submenu.show').forEach(submenu => {\n                        submenu.classList.remove('show');\n                    });\n                    document.querySelectorAll('.menu-arrow.rotated').forEach(arrow => {\n                        arrow.classList.remove('rotated');\n                    });\n                }\n            }\n        }\n\n        toggleBtn.addEventListener('click', toggleSidebar);\n        mobileOverlay.addEventListener('click', toggleSidebar);\n\n        // Dropdown functionality\n        document.querySelectorAll('[data-toggle]').forEach(link => {\n            link.addEventListener('click', function(e) {\n                e.preventDefault();\n                \n                if (isCollapsed && !isMobile) return;\n                \n                const target = this.getAttribute('data-toggle');\n                const submenu = document.getElementById(target + '-submenu');\n                const arrow = this.querySelector('.menu-arrow');\n                \n                // Close other dropdowns\n                document.querySelectorAll('.submenu.show').forEach(otherSubmenu => {\n                    if (otherSubmenu !== submenu) {\n                        otherSubmenu.classList.remove('show');\n                    }\n                });\n                \n                document.querySelectorAll('.menu-arrow.rotated').forEach(otherArrow => {\n                    if (otherArrow !== arrow) {\n                        otherArrow.classList.remove('rotated');\n                    }\n                });\n                \n                // Toggle current dropdown\n                submenu.classList.toggle('show');\n                arrow.classList.toggle('rotated');\n                \n                // Set active state\n                document.querySelectorAll('.menu-link.active').forEach(activeLink => {\n                    activeLink.classList.remove('active');\n                });\n                this.classList.add('active');\n            });\n        });\n\n        // User menu functionality\n        const userProfile = document.getElementById('userProfile');\n        const userMenu = document.getElementById('userMenu');\n        \n        userProfile.addEventListener('click', function(e) {\n            e.stopPropagation();\n            userMenu.classList.toggle('show');\n        });\n\n        // Close user menu when clicking outside\n        document.addEventListener('click', function() {\n            userMenu.classList.remove('show');\n        });\n\n        // Password toggle functionality\n        function togglePassword(fieldId) {\n            const field = document.getElementById(fieldId);\n            const icon = document.getElementById(fieldId + '_icon');\n            \n            if (field.type === 'password') {\n                field.type = 'text';\n                icon.className = 'bi bi-eye-slash';\n            } else {\n                field.type = 'password';\n                icon.className = 'bi bi-eye';\n            }\n        }\n\n        // Form validation\n        document.getElementById('profileForm').addEventListener('submit', function(e) {\n            const newPassword = document.getElementById('new_password').value;\n            const confirmPassword = document.getElementById('confirm_password').value;\n            const currentPassword = document.getElementById('current_password').value;\n            \n            // Only validate password if user is trying to change it\n            if (newPassword || confirmPassword) {\n                if (!currentPassword) {\n                    e.prevent"
  },
  {
    "tipo": "inline",
    "index": 0,
    "conteudo": "\n        // Vari√°veis globais\n        let empresaSelecionada = null;\n        let produtosCarregados = [];\n        let produtosFiltrados = [];\n        let arquivosXML = [];\n        let paginaAtual = 1;\n        const linhasPorPagina = 1000;\n\n        function escapeHtml(str) {\n            if (str == null) return '';\n            return String(str)\n            .replace(/&/g, '&amp;')\n            .replace(/</g, '&lt;')\n            .replace(/>/g, '&gt;')\n            .replace(/\"/g, '&quot;')\n            .replace(/'/g, '&#39;');\n        }\n\n        function truncateText(text, length = 20) {\n            if (text == null) return '';\n            return text.length > length ? text.substring(0, length) : text;\n        }\n\n        function aplicarFiltro() {\n            const somenteDiferentes = document.getElementById(\"filtroDiferentes\").checked;\n\n            if (somenteDiferentes) {\n                produtosFiltrados = produtosCarregados.filter(p => \n                    p.ncm && \n                    p.ncm_consulta && \n                    p.ncm.trim() !== p.ncm_consulta.trim() &&\n                    p.ncm_consulta !== 'N√£o encontrado'\n                );\n            } else {\n                produtosFiltrados = [...produtosCarregados];\n            }\n\n            paginaAtual = 1;\n            atualizarTabela();\n        }\n\n        /* --------------------------\n        FUN√á√ÉO AUXILIAR: c√©lula truncada com tooltip\n        ----------------------------*/\n        function criarCelula(texto) {\n            const td = document.createElement(\"td\");\n            td.classList.add(\"truncate-cell\");\n            td.textContent = texto ? texto.substring(0, 15) : \"\";\n            td.title = texto ?? \"\";\n            return td;\n        }\n\n        /* --------------------------\n        C√ÅLCULO DA P√ÅGINA\n        ----------------------------*/\n        function obterPagina(pagina) {\n            const inicio = (pagina - 1) * linhasPorPagina;\n            return produtosCarregados.slice(inicio, inicio + linhasPorPagina);\n        }\n\n        /* --------------------------\n        ATUALIZAR PAGINA√á√ÉO\n        ----------------------------*/\n        function atualizarPaginacao(totalRegistros) {\n            const elemTotalPaginas = document.getElementById(\"totalPaginas\");\n            const elemPaginaAtual = document.getElementById(\"paginaAtual\");\n            const btnAnterior = document.getElementById(\"btnAnterior\");\n            const btnProximo = document.getElementById(\"btnProximo\");\n\n            // Se a pagina√ß√£o n√£o existir na tela ainda, n√£o faz nada\n            if (!elemTotalPaginas || !elemPaginaAtual || !btnAnterior || !btnProximo) {\n                return;\n            }\n\n            totalRegistros = totalRegistros || produtosFiltrados.length || produtosCarregados.length;\n\n            const totalPaginas = Math.ceil(totalRegistros / linhasPorPagina);\n\n            elemTotalPaginas.innerText = totalPaginas;\n            elemPaginaAtual.innerText = paginaAtual;\n\n            btnAnterior.disabled = paginaAtual === 1;\n            btnProximo.disabled = paginaAtual === totalPaginas;\n        }\n\n        function paginaAnterior() {\n            if (paginaAtual > 1) {\n                paginaAtual--;\n                atualizarTabela();\n            }\n        }\n\n        function proximaPagina() {\n            const totalPaginas = Math.ceil(produtosCarregados.length / linhasPorPagina);\n            if (paginaAtual < totalPaginas) {\n                paginaAtual++;\n                atualizarTabela();\n            }\n        }\n\n        // Fun√ß√£o para obter o CSRF token\n        function getCookie(name) {\n            let cookieValue = null;\n            if (document.cookie && document.cookie !== '') {\n                const cookies = document.cookie.split(';');\n                for (let i = 0; i < cookies.length; i++) {\n                    const cookie = cookies[i].trim();\n                    if (cookie.substring(0, name.length + 1) === (name + '=')) {\n                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));\n                        break;\n                    }\n                }\n            }\n            return cookieValue;\n        }\n\n        const csrftoken = getCookie('csrftoken');\n\n        // Carregar empresas ao iniciar\n        document.addEventListener('DOMContentLoaded', function() {\n            carregarEmpresas();\n            configurarEventos();\n        });\n\n        function configurarEventos() {\n            document.getElementById('empresaSelect').addEventListener('change', onEmpresaChange);\n            document.getElementById('fonteSelect').addEventListener('change', onFonteChange);\n            document.getElementById('btnBuscarSPED').addEventListener('click', buscarSPED);\n            document.getElementById('btnBuscarXML').addEventListener('click', () => {\n                document.getElementById('xmlModal').style.display = 'block';\n            });\n            document.getElementById('btnExportar').addEventListener('click', exportarExcel);\n       "
  },
  {
    "tipo": "inline",
    "index": 1,
    "conteudo": "\n        // --- 1. L√≥gica para carregar Toasts na inicializa√ß√£o ---\n        //const toastElList = [].slice.call(document.querySelectorAll('.toast'));\n        //const toastList = toastElList.map(function(toastEl) {\n            // Cria uma inst√¢ncia do Toast e a exibe\n        //    const toast = new bootstrap.Toast(toastEl);\n        //    toast.show();\n        //    return toast;\n        //});\n\n        // Sidebar functionality\n        const sidebar = document.getElementById('sidebar');\n        const mainContent = document.getElementById('mainContent');\n        const toggleBtn = document.getElementById('toggleSidebar');\n        const toggleIcon = document.getElementById('toggleIcon');\n        const mobileOverlay = document.getElementById('mobileOverlay');\n        \n        let isCollapsed = false;\n        let isMobile = window.innerWidth <= 768;\n\n        // Toggle sidebar\n        function toggleSidebar() {\n            if (isMobile) {\n                sidebar.classList.toggle('show');\n                mobileOverlay.classList.toggle('show');\n            } else {\n                isCollapsed = !isCollapsed;\n                sidebar.classList.toggle('collapsed');\n                mainContent.classList.toggle('expanded');\n                toggleIcon.className = isCollapsed ? 'bi bi-chevron-right' : 'bi bi-chevron-left';\n                \n                // Close all dropdowns when collapsing\n                if (isCollapsed) {\n                    document.querySelectorAll('.submenu.show').forEach(submenu => {\n                        submenu.classList.remove('show');\n                    });\n                    document.querySelectorAll('.menu-arrow.rotated').forEach(arrow => {\n                        arrow.classList.remove('rotated');\n                    });\n                }\n            }\n        }\n\n        toggleBtn.addEventListener('click', toggleSidebar);\n        mobileOverlay.addEventListener('click', toggleSidebar);\n\n        // Dropdown functionality\n        document.querySelectorAll('[data-toggle]').forEach(link => {\n            link.addEventListener('click', function(e) {\n                e.preventDefault();\n                \n                if (isCollapsed && !isMobile) return;\n                \n                const target = this.getAttribute('data-toggle');\n                const submenu = document.getElementById(target + '-submenu');\n                const arrow = this.querySelector('.menu-arrow');\n                \n                // Close other dropdowns\n                document.querySelectorAll('.submenu.show').forEach(otherSubmenu => {\n                    if (otherSubmenu !== submenu) {\n                        otherSubmenu.classList.remove('show');\n                    }\n                });\n                \n                document.querySelectorAll('.menu-arrow.rotated').forEach(otherArrow => {\n                    if (otherArrow !== arrow) {\n                        otherArrow.classList.remove('rotated');\n                    }\n                });\n                \n                // Toggle current dropdown\n                submenu.classList.toggle('show');\n                arrow.classList.toggle('rotated');\n                \n                // Set active state\n                document.querySelectorAll('.menu-link.active').forEach(activeLink => {\n                    activeLink.classList.remove('active');\n                });\n                this.classList.add('active');\n            });\n        });\n\n        // User menu functionality\n        const userProfile = document.getElementById('userProfile');\n        const userMenu = document.getElementById('userMenu');\n        \n        userProfile.addEventListener('click', function(e) {\n            e.stopPropagation();\n            userMenu.classList.toggle('show');\n        });\n\n        // Close user menu when clicking outside\n        document.addEventListener('click', function() {\n            userMenu.classList.remove('show');\n        });\n\n        // Password toggle functionality\n        function togglePassword(fieldId) {\n            const field = document.getElementById(fieldId);\n            const icon = document.getElementById(fieldId + '_icon');\n            \n            if (field.type === 'password') {\n                field.type = 'text';\n                icon.className = 'bi bi-eye-slash';\n            } else {\n                field.type = 'password';\n                icon.className = 'bi bi-eye';\n            }\n        }\n\n        // Form validation\n        document.getElementById('profileForm').addEventListener('submit', function(e) {\n            const newPassword = document.getElementById('new_password').value;\n            const confirmPassword = document.getElementById('confirm_password').value;\n            const currentPassword = document.getElementById('current_password').value;\n            \n            // Only validate password if user is trying to change it\n            if (newPassword || confirmPassword) {\n                if (!currentPassword) {\n                    e.prevent"
  },
  {
    "tipo": "inline",
    "index": 0,
    "conteudo": "\n    function voltar() {\n        if (document.referrer !== \"\") {\n            window.history.back();\n        } else {\n            window.location.href = \"/\";\n        }\n    }\n"
  },
  {
    "tipo": "inline",
    "index": 1,
    "conteudo": "\n        // --- 1. L√≥gica para carregar Toasts na inicializa√ß√£o ---\n        //const toastElList = [].slice.call(document.querySelectorAll('.toast'));\n        //const toastList = toastElList.map(function(toastEl) {\n            // Cria uma inst√¢ncia do Toast e a exibe\n        //    const toast = new bootstrap.Toast(toastEl);\n        //    toast.show();\n        //    return toast;\n        //});\n\n        // Sidebar functionality\n        const sidebar = document.getElementById('sidebar');\n        const mainContent = document.getElementById('mainContent');\n        const toggleBtn = document.getElementById('toggleSidebar');\n        const toggleIcon = document.getElementById('toggleIcon');\n        const mobileOverlay = document.getElementById('mobileOverlay');\n        \n        let isCollapsed = false;\n        let isMobile = window.innerWidth <= 768;\n\n        // Toggle sidebar\n        function toggleSidebar() {\n            if (isMobile) {\n                sidebar.classList.toggle('show');\n                mobileOverlay.classList.toggle('show');\n            } else {\n                isCollapsed = !isCollapsed;\n                sidebar.classList.toggle('collapsed');\n                mainContent.classList.toggle('expanded');\n                toggleIcon.className = isCollapsed ? 'bi bi-chevron-right' : 'bi bi-chevron-left';\n                \n                // Close all dropdowns when collapsing\n                if (isCollapsed) {\n                    document.querySelectorAll('.submenu.show').forEach(submenu => {\n                        submenu.classList.remove('show');\n                    });\n                    document.querySelectorAll('.menu-arrow.rotated').forEach(arrow => {\n                        arrow.classList.remove('rotated');\n                    });\n                }\n            }\n        }\n\n        toggleBtn.addEventListener('click', toggleSidebar);\n        mobileOverlay.addEventListener('click', toggleSidebar);\n\n        // Dropdown functionality\n        document.querySelectorAll('[data-toggle]').forEach(link => {\n            link.addEventListener('click', function(e) {\n                e.preventDefault();\n                \n                if (isCollapsed && !isMobile) return;\n                \n                const target = this.getAttribute('data-toggle');\n                const submenu = document.getElementById(target + '-submenu');\n                const arrow = this.querySelector('.menu-arrow');\n                \n                // Close other dropdowns\n                document.querySelectorAll('.submenu.show').forEach(otherSubmenu => {\n                    if (otherSubmenu !== submenu) {\n                        otherSubmenu.classList.remove('show');\n                    }\n                });\n                \n                document.querySelectorAll('.menu-arrow.rotated').forEach(otherArrow => {\n                    if (otherArrow !== arrow) {\n                        otherArrow.classList.remove('rotated');\n                    }\n                });\n                \n                // Toggle current dropdown\n                submenu.classList.toggle('show');\n                arrow.classList.toggle('rotated');\n                \n                // Set active state\n                document.querySelectorAll('.menu-link.active').forEach(activeLink => {\n                    activeLink.classList.remove('active');\n                });\n                this.classList.add('active');\n            });\n        });\n\n        // User menu functionality\n        const userProfile = document.getElementById('userProfile');\n        const userMenu = document.getElementById('userMenu');\n        \n        userProfile.addEventListener('click', function(e) {\n            e.stopPropagation();\n            userMenu.classList.toggle('show');\n        });\n\n        // Close user menu when clicking outside\n        document.addEventListener('click', function() {\n            userMenu.classList.remove('show');\n        });\n\n        // Password toggle functionality\n        function togglePassword(fieldId) {\n            const field = document.getElementById(fieldId);\n            const icon = document.getElementById(fieldId + '_icon');\n            \n            if (field.type === 'password') {\n                field.type = 'text';\n                icon.className = 'bi bi-eye-slash';\n            } else {\n                field.type = 'password';\n                icon.className = 'bi bi-eye';\n            }\n        }\n\n        // Form validation\n        document.getElementById('profileForm').addEventListener('submit', function(e) {\n            const newPassword = document.getElementById('new_password').value;\n            const confirmPassword = document.getElementById('confirm_password').value;\n            const currentPassword = document.getElementById('current_password').value;\n            \n            // Only validate password if user is trying to change it\n            if (newPassword || confirmPassword) {\n                if (!currentPassword) {\n                    e.prevent"
  },
  {
    "tipo": "externo",
    "src": "https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"
  },
  {
    "tipo": "inline",
    "index": 1,
    "conteudo": "\n        // ========================================================================\n        // VARI√ÅVEIS GLOBAIS - DECLARAR NO IN√çCIO\n        // ========================================================================\n        \n        // Vari√°veis globais para lan√ßamentos manuais\n        let empresaSelecionada = null;\n        let periodoInicial = null;\n        let periodoFinal = null;\n        let lancamentoParaExcluir = null;\n        let tipoExclusao = null;\n\n        // ========================================================================\n        // INTERCEPTAR FORM IMEDIATAMENTE - ANTES DE TUDO\n        // ========================================================================\n        \n        // SOLU√á√ÉO DEFINITIVA: Interceptar o submit ANTES do DOMContentLoaded\n        (function() {\n            // Executar assim que o script carregar\n            if (document.readyState === 'loading') {\n                document.addEventListener('DOMContentLoaded', interceptarFormulario, false);\n            } else {\n                // DOM j√° carregado, executar imediatamente\n                interceptarFormulario();\n            }\n            \n            function interceptarFormulario() {\n                // Tentar m√∫ltiplas vezes at√© encontrar o form\n                let tentativas = 0;\n                const maxTentativas = 20;\n                \n                const intervalo = setInterval(function() {\n                    tentativas++;\n                    \n                    const form = document.querySelector('form');\n                    const btnFiltrar = form ? form.querySelector('button[type=\"submit\"]') : null;\n                    \n                    if (btnFiltrar || tentativas >= maxTentativas) {\n                        clearInterval(intervalo);\n                        \n                        if (btnFiltrar) {\n                            console.log('üéØ INTERCEPTA√á√ÉO: Bot√£o encontrado, configurando listeners...');\n                            \n                            // SOLU√á√ÉO: Adicionar onclick DIRETO no elemento (maior prioridade)\n                            const onclickOriginal = btnFiltrar.onclick;\n                            btnFiltrar.onclick = function(e) {\n                                console.log('üñ±Ô∏è ONCLICK DISPARADO!');\n                                mostrarSpinnerCarregamento();\n                                \n                                // Chamar o onclick original se existir\n                                if (onclickOriginal) {\n                                    onclickOriginal.call(this, e);\n                                }\n                            };\n                            \n                            // Tamb√©m adicionar via addEventListener com capturing\n                            btnFiltrar.addEventListener('click', function(e) {\n                                console.log('üñ±Ô∏è CLICK LISTENER DISPARADO!');\n                                mostrarSpinnerCarregamento();\n                            }, true); // useCapture = true\n                            \n                            // E no mousedown\n                            btnFiltrar.addEventListener('mousedown', function(e) {\n                                console.log('üñ±Ô∏è MOUSEDOWN DISPARADO!');\n                                mostrarSpinnerCarregamento();\n                            }, true);\n                            \n                            console.log('‚úÖ Listeners configurados com sucesso!');\n                        } else {\n                            console.warn('‚ö†Ô∏è Bot√£o n√£o encontrado ap√≥s', tentativas, 'tentativas');\n                        }\n                    }\n                }, 50); // Tentar a cada 50ms\n            }\n        })();\n\n        // Fun√ß√£o para carregar per√≠odos quando a empresa mudar\n        function carregarPeriodos() {\n            const empresaId = document.getElementById('empresaSelect').value;\n            const periodoInicialSelect = document.getElementById('periodoInicialSelect');\n            const periodoFinalSelect = document.getElementById('periodoFinalSelect');\n            \n            if (!empresaId) {\n                periodoInicialSelect.innerHTML = '<option value=\"\">Selecione o in√≠cio</option>';\n                periodoFinalSelect.innerHTML = '<option value=\"\">Selecione o fim</option>';\n                return;\n            }\n            \n            // Mostrar spinner antes de recarregar\n            mostrarSpinnerCarregamento();\n            \n            // Recarregar a p√°gina com a nova empresa para buscar per√≠odos\n            const url = new URL(window.location.href);\n            url.searchParams.set('empresa', empresaId);\n            url.searchParams.delete('periodo_inicial');\n            url.searchParams.delete('periodo_final');\n            window.location.href = url.toString();\n        }\n        \n        // Valida√ß√£o: per√≠odo final n√£o pode ser anterior ao inicial\n        document.addEventListener('DOMContentLoaded', function() {\n            setTimeout(function() {\n      "
  },
  {
    "tipo": "inline",
    "index": 2,
    "conteudo": "\n        // --- 1. L√≥gica para carregar Toasts na inicializa√ß√£o ---\n        //const toastElList = [].slice.call(document.querySelectorAll('.toast'));\n        //const toastList = toastElList.map(function(toastEl) {\n            // Cria uma inst√¢ncia do Toast e a exibe\n        //    const toast = new bootstrap.Toast(toastEl);\n        //    toast.show();\n        //    return toast;\n        //});\n\n        // Sidebar functionality\n        const sidebar = document.getElementById('sidebar');\n        const mainContent = document.getElementById('mainContent');\n        const toggleBtn = document.getElementById('toggleSidebar');\n        const toggleIcon = document.getElementById('toggleIcon');\n        const mobileOverlay = document.getElementById('mobileOverlay');\n        \n        let isCollapsed = false;\n        let isMobile = window.innerWidth <= 768;\n\n        // Toggle sidebar\n        function toggleSidebar() {\n            if (isMobile) {\n                sidebar.classList.toggle('show');\n                mobileOverlay.classList.toggle('show');\n            } else {\n                isCollapsed = !isCollapsed;\n                sidebar.classList.toggle('collapsed');\n                mainContent.classList.toggle('expanded');\n                toggleIcon.className = isCollapsed ? 'bi bi-chevron-right' : 'bi bi-chevron-left';\n                \n                // Close all dropdowns when collapsing\n                if (isCollapsed) {\n                    document.querySelectorAll('.submenu.show').forEach(submenu => {\n                        submenu.classList.remove('show');\n                    });\n                    document.querySelectorAll('.menu-arrow.rotated').forEach(arrow => {\n                        arrow.classList.remove('rotated');\n                    });\n                }\n            }\n        }\n\n        toggleBtn.addEventListener('click', toggleSidebar);\n        mobileOverlay.addEventListener('click', toggleSidebar);\n\n        // Dropdown functionality\n        document.querySelectorAll('[data-toggle]').forEach(link => {\n            link.addEventListener('click', function(e) {\n                e.preventDefault();\n                \n                if (isCollapsed && !isMobile) return;\n                \n                const target = this.getAttribute('data-toggle');\n                const submenu = document.getElementById(target + '-submenu');\n                const arrow = this.querySelector('.menu-arrow');\n                \n                // Close other dropdowns\n                document.querySelectorAll('.submenu.show').forEach(otherSubmenu => {\n                    if (otherSubmenu !== submenu) {\n                        otherSubmenu.classList.remove('show');\n                    }\n                });\n                \n                document.querySelectorAll('.menu-arrow.rotated').forEach(otherArrow => {\n                    if (otherArrow !== arrow) {\n                        otherArrow.classList.remove('rotated');\n                    }\n                });\n                \n                // Toggle current dropdown\n                submenu.classList.toggle('show');\n                arrow.classList.toggle('rotated');\n                \n                // Set active state\n                document.querySelectorAll('.menu-link.active').forEach(activeLink => {\n                    activeLink.classList.remove('active');\n                });\n                this.classList.add('active');\n            });\n        });\n\n        // User menu functionality\n        const userProfile = document.getElementById('userProfile');\n        const userMenu = document.getElementById('userMenu');\n        \n        userProfile.addEventListener('click', function(e) {\n            e.stopPropagation();\n            userMenu.classList.toggle('show');\n        });\n\n        // Close user menu when clicking outside\n        document.addEventListener('click', function() {\n            userMenu.classList.remove('show');\n        });\n\n        // Password toggle functionality\n        function togglePassword(fieldId) {\n            const field = document.getElementById(fieldId);\n            const icon = document.getElementById(fieldId + '_icon');\n            \n            if (field.type === 'password') {\n                field.type = 'text';\n                icon.className = 'bi bi-eye-slash';\n            } else {\n                field.type = 'password';\n                icon.className = 'bi bi-eye';\n            }\n        }\n\n        // Form validation\n        document.getElementById('profileForm').addEventListener('submit', function(e) {\n            const newPassword = document.getElementById('new_password').value;\n            const confirmPassword = document.getElementById('confirm_password').value;\n            const currentPassword = document.getElementById('current_password').value;\n            \n            // Only validate password if user is trying to change it\n            if (newPassword || confirmPassword) {\n                if (!currentPassword) {\n                    e.prevent"
  },
  {
    "tipo": "externo",
    "src": "https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
  },
  {
    "tipo": "inline",
    "index": 1,
    "conteudo": "\n    document.addEventListener('DOMContentLoaded', function () {\n        const genericModalEl = document.getElementById('genericModal');\n        const genericModal = new bootstrap.Modal(genericModalEl);\n        const modalContentWrapper = document.getElementById('modal-content-wrapper');\n        const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]') ? document.querySelector('[name=csrfmiddlewaretoken]').value : 'DoPrLdjYLVdMSQzQ83JXxbAeFAbS8x0cm4felmEY2voRLhrWlPXLoBYZfXidzXGN';\n\n        // Fun√ß√£o para exibir toast de loading\n        function showLoadingToast(message) {\n            const toastContainer = document.querySelector('.toast-container');\n            const toastHTML = `\n                <div class=\"toast align-items-center text-bg-info border-0\" role=\"alert\" aria-live=\"assertive\" aria-atomic=\"true\" data-loading=\"true\">\n                    <div class=\"d-flex\">\n                        <div class=\"toast-body\">\n                            <i class=\"fas fa-spinner fa-spin me-2\"></i>${message}\n                        </div>\n                    </div>\n                </div>\n            `;\n            \n            toastContainer.insertAdjacentHTML('beforeend', toastHTML);\n            const toastEl = toastContainer.lastElementChild;\n            const toast = new bootstrap.Toast(toastEl, { autohide: false });\n            toast.show();\n            \n            return toastEl;\n        }\n\n        // Fun√ß√£o para remover toast espec√≠fico\n        function removeToast(toastEl) {\n            if (toastEl) {\n                const toast = bootstrap.Toast.getInstance(toastEl);\n                if (toast) {\n                    toast.hide();\n                }\n                setTimeout(() => toastEl.remove(), 300);\n            }\n        }\n\n        // Fun√ß√£o para exibir toasts din√¢micos\n        function showToast(message, type = 'danger') {\n            const toastContainer = document.querySelector('.toast-container');\n            const toastClass = type === 'success' ? 'text-bg-success' : \n                            type === 'info' ? 'text-bg-info' : 'text-bg-danger';\n            \n            const toastHTML = `\n                <div class=\"toast align-items-center ${toastClass} border-0\" role=\"alert\" aria-live=\"assertive\" aria-atomic=\"true\">\n                    <div class=\"d-flex\">\n                        <div class=\"toast-body\">${message}</div>\n                        <button type=\"button\" class=\"btn-close btn-close-white me-2 m-auto\" data-bs-dismiss=\"toast\" aria-label=\"Close\"></button>\n                    </div>\n                </div>\n            `;\n            \n            toastContainer.insertAdjacentHTML('beforeend', toastHTML);\n            const toastEl = toastContainer.lastElementChild;\n            const toast = new bootstrap.Toast(toastEl, { delay: 5000 });\n            toast.show();\n            \n            // Remove o elemento do DOM ap√≥s fechar\n            toastEl.addEventListener('hidden.bs.toast', function() {\n                toastEl.remove();\n            });\n        }\n\n        // ============= NOVA FUNCIONALIDADE: BUSCA AUTOM√ÅTICA DE CNPJ =============\n    \n        // Fun√ß√£o para configurar a busca de CNPJ em um formul√°rio\n        function setupCNPJAutocomplete(formElement) {\n            const cnpjInput = formElement.querySelector('#id_cnpj_cpf');\n            const razaoSocialInput = formElement.querySelector('#id_razao_social');\n            const ufSelect = formElement.querySelector('#id_uf');\n            \n            if (!cnpjInput) return;\n\n            // Fun√ß√£o para limpar e formatar CNPJ\n            function limparCNPJ(cnpj) {\n                return cnpj.replace(/\\D/g, '');\n            }\n\n            // Fun√ß√£o para validar CNPJ (14 d√≠gitos)\n            function validarCNPJ(cnpj) {\n                const cnpjLimpo = limparCNPJ(cnpj);\n                return cnpjLimpo.length === 14;\n            }\n\n            // Fun√ß√£o para buscar dados na API\n            async function buscarDadosCNPJ(cnpj) {\n                const cnpjLimpo = limparCNPJ(cnpj);\n                \n                if (!validarCNPJ(cnpjLimpo)) {\n                    return;\n                }\n\n                // Exibe loading\n                const loadingToast = showLoadingToast('üîç Buscando dados do CNPJ...');\n\n                try {\n                    const response = await fetch(`https://brasilapi.com.br/api/cnpj/v1/${cnpjLimpo}`);\n                    \n                    if (!response.ok) {\n                        throw new Error('CNPJ n√£o encontrado ou inv√°lido');\n                    }\n\n                    const data = await response.json();\n                    \n                    // Preenche os campos com os dados retornados\n                    preencherCampos(data);\n                    \n                    // Remove loading e exibe sucesso\n                    removeToast(loadingToast);\n                    showToast('‚úÖ Dados da empresa carregados com sucesso!', 'success');\n                    \n                } catch (error) {\n  "
  },
  {
    "tipo": "inline",
    "index": 2,
    "conteudo": "\n        // --- 1. L√≥gica para carregar Toasts na inicializa√ß√£o ---\n        //const toastElList = [].slice.call(document.querySelectorAll('.toast'));\n        //const toastList = toastElList.map(function(toastEl) {\n            // Cria uma inst√¢ncia do Toast e a exibe\n        //    const toast = new bootstrap.Toast(toastEl);\n        //    toast.show();\n        //    return toast;\n        //});\n\n        // Sidebar functionality\n        const sidebar = document.getElementById('sidebar');\n        const mainContent = document.getElementById('mainContent');\n        const toggleBtn = document.getElementById('toggleSidebar');\n        const toggleIcon = document.getElementById('toggleIcon');\n        const mobileOverlay = document.getElementById('mobileOverlay');\n        \n        let isCollapsed = false;\n        let isMobile = window.innerWidth <= 768;\n\n        // Toggle sidebar\n        function toggleSidebar() {\n            if (isMobile) {\n                sidebar.classList.toggle('show');\n                mobileOverlay.classList.toggle('show');\n            } else {\n                isCollapsed = !isCollapsed;\n                sidebar.classList.toggle('collapsed');\n                mainContent.classList.toggle('expanded');\n                toggleIcon.className = isCollapsed ? 'bi bi-chevron-right' : 'bi bi-chevron-left';\n                \n                // Close all dropdowns when collapsing\n                if (isCollapsed) {\n                    document.querySelectorAll('.submenu.show').forEach(submenu => {\n                        submenu.classList.remove('show');\n                    });\n                    document.querySelectorAll('.menu-arrow.rotated').forEach(arrow => {\n                        arrow.classList.remove('rotated');\n                    });\n                }\n            }\n        }\n\n        toggleBtn.addEventListener('click', toggleSidebar);\n        mobileOverlay.addEventListener('click', toggleSidebar);\n\n        // Dropdown functionality\n        document.querySelectorAll('[data-toggle]').forEach(link => {\n            link.addEventListener('click', function(e) {\n                e.preventDefault();\n                \n                if (isCollapsed && !isMobile) return;\n                \n                const target = this.getAttribute('data-toggle');\n                const submenu = document.getElementById(target + '-submenu');\n                const arrow = this.querySelector('.menu-arrow');\n                \n                // Close other dropdowns\n                document.querySelectorAll('.submenu.show').forEach(otherSubmenu => {\n                    if (otherSubmenu !== submenu) {\n                        otherSubmenu.classList.remove('show');\n                    }\n                });\n                \n                document.querySelectorAll('.menu-arrow.rotated').forEach(otherArrow => {\n                    if (otherArrow !== arrow) {\n                        otherArrow.classList.remove('rotated');\n                    }\n                });\n                \n                // Toggle current dropdown\n                submenu.classList.toggle('show');\n                arrow.classList.toggle('rotated');\n                \n                // Set active state\n                document.querySelectorAll('.menu-link.active').forEach(activeLink => {\n                    activeLink.classList.remove('active');\n                });\n                this.classList.add('active');\n            });\n        });\n\n        // User menu functionality\n        const userProfile = document.getElementById('userProfile');\n        const userMenu = document.getElementById('userMenu');\n        \n        userProfile.addEventListener('click', function(e) {\n            e.stopPropagation();\n            userMenu.classList.toggle('show');\n        });\n\n        // Close user menu when clicking outside\n        document.addEventListener('click', function() {\n            userMenu.classList.remove('show');\n        });\n\n        // Password toggle functionality\n        function togglePassword(fieldId) {\n            const field = document.getElementById(fieldId);\n            const icon = document.getElementById(fieldId + '_icon');\n            \n            if (field.type === 'password') {\n                field.type = 'text';\n                icon.className = 'bi bi-eye-slash';\n            } else {\n                field.type = 'password';\n                icon.className = 'bi bi-eye';\n            }\n        }\n\n        // Form validation\n        document.getElementById('profileForm').addEventListener('submit', function(e) {\n            const newPassword = document.getElementById('new_password').value;\n            const confirmPassword = document.getElementById('confirm_password').value;\n            const currentPassword = document.getElementById('current_password').value;\n            \n            // Only validate password if user is trying to change it\n            if (newPassword || confirmPassword) {\n                if (!currentPassword) {\n                    e.prevent"
  },
  {
    "tipo": "externo",
    "src": "https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
  },
  {
    "tipo": "inline",
    "index": 1,
    "conteudo": "\ndocument.addEventListener(\"DOMContentLoaded\", function() {\n\n    // --- C√ìDIGO PARA INICIALIZAR OS TOOLTIPS - LIMITES DE USERS ---\n    const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle=\"tooltip\"]'));\n    const tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {\n        return new bootstrap.Tooltip(tooltipTriggerEl);\n    });\n    \n    // --- 2. L√≥gica para carregar o Modal dinamicamente ---\n    const modalElement = document.getElementById('formModal');\n    const modal = new bootstrap.Modal(modalElement);\n    const modalContent = modalElement.querySelector('.modal-content');\n\n    // Adiciona listener para todos os bot√µes que abrem o modal\n    document.querySelectorAll('.modal-trigger').forEach(button => {\n        button.addEventListener('click', function() {\n            const url = this.dataset.url;\n            \n            // --- DEBUG 1 ---\n            console.log(\"1. Clicou no bot√£o. URL a buscar:\", url);\n            \n            // Mostra um spinner enquanto carrega\n            modalContent.innerHTML = `\n                <div class=\"modal-body text-center p-5\">\n                    <div class=\"spinner-border text-primary\" role=\"status\">\n                        <span class=\"visually-hidden\">Carregando...</span>\n                    </div>\n                </div>`;\n            \n            // Busca o conte√∫do do formul√°rio (HTML parcial)\n            fetch(url)\n                .then(response => {\n                    // --- DEBUG 2 ---\n                    console.log(\"2. Resposta do servidor recebida. Status:\", response.status, response.statusText);\n\n                    // VERIFICA SE A RESPOSTA FOI UM SUCESSO (c√≥digos 200-299)\n                    if (!response.ok) {\n                        // Se for 404, 500, 403, etc., cai aqui.\n                        console.error(\"Erro HTTP! O servidor respondeu com status\", response.status);\n                        // Lan√ßa um erro customizado para cair no .catch()\n                        throw new Error(`Erro ${response.status}: ${response.statusText}`);\n                    }\n                    \n                    // Se response.ok for true, continua normal\n                    return response.text();\n                })\n                .then(html => {\n                    // --- DEBUG 3 ---\n                    console.log(\"3. Sucesso! Carregando HTML no modal.\");\n                    modalContent.innerHTML = html;\n                    \n                    // Define a action do formul√°rio que acabamos de carregar\n                    const form = modalContent.querySelector('form');\n                    if (form) {\n                        form.action = url;\n                    }\n                })\n                .catch(error => {\n                    // --- DEBUG 4 (BLOCO DE ERRO) ---\n                    console.error(\"4. CAIU NO CATCH! Ocorreu um erro na requisi√ß√£o:\", error);\n                    modalContent.innerHTML = `<div class=\"modal-body alert alert-danger\"><strong>Erro ao carregar:</strong> ${error.message}. <br>Verifique o console (F12) para mais detalhes.</div>`;\n                });\n        });\n    });\n\n    \n    // --- 3. L√≥gica para enviar o formul√°rio do modal via Fetch ---\n    modalElement.addEventListener('submit', function(event) {\n        // Verificamos se o evento √© de um formul√°rio\n        if (event.target.tagName !== 'FORM') {\n            return;\n        }\n        \n        event.preventDefault(); // Impede o envio padr√£o\n        \n        const form = event.target;\n        const formData = new FormData(form);\n        const url = form.action;\n\n        const headers = new Headers({\n            'X-Requested-With': 'XMLHttpRequest'\n        });\n\n        fetch(url, {\n            method: 'POST',\n            body: formData,\n            headers: headers,\n            redirect: 'manual' // <--- A MUDAN√áA CRUCIAL\n        })\n        .then(response => {\n            // 'redirect: manual' faz com que um 302 (redirect) N√ÉO seja seguido.\n            // Em vez disso, recebemos uma resposta com type 'opaqueredirect'.\n            \n            console.log(\"Submit response type:\", response.type, \"Status:\", response.status);\n\n            // Verificamos pelo tipo 'opaqueredirect' (mais seguro) ou pelo status 302\n            if (response.type === 'opaqueredirect' || response.status === 302) {\n                // SUCESSO! O form foi v√°lido e o Django mandou um redirect.\n                // O fetch N√ÉO seguiu o redirect (GET #1 n√£o aconteceu).\n                // As messages ainda est√£o na sess√£o.\n                \n                modal.hide();\n                \n                // Agora n√≥s fazemos o reload (Este ser√° o √öNICO GET)\n                // O window.location.reload() vai buscar a p√°gina,\n                // o Django vai renderizar as messages (consumindo-as),\n                // e o script do toast (L√≥gica 1) vai exibi-las.\n                window.location.reload(); \n                \n                // Retornamos null para n√£o entrar no pr√≥"
  },
  {
    "tipo": "inline",
    "index": 2,
    "conteudo": "\n        // --- 1. L√≥gica para carregar Toasts na inicializa√ß√£o ---\n        //const toastElList = [].slice.call(document.querySelectorAll('.toast'));\n        //const toastList = toastElList.map(function(toastEl) {\n            // Cria uma inst√¢ncia do Toast e a exibe\n        //    const toast = new bootstrap.Toast(toastEl);\n        //    toast.show();\n        //    return toast;\n        //});\n\n        // Sidebar functionality\n        const sidebar = document.getElementById('sidebar');\n        const mainContent = document.getElementById('mainContent');\n        const toggleBtn = document.getElementById('toggleSidebar');\n        const toggleIcon = document.getElementById('toggleIcon');\n        const mobileOverlay = document.getElementById('mobileOverlay');\n        \n        let isCollapsed = false;\n        let isMobile = window.innerWidth <= 768;\n\n        // Toggle sidebar\n        function toggleSidebar() {\n            if (isMobile) {\n                sidebar.classList.toggle('show');\n                mobileOverlay.classList.toggle('show');\n            } else {\n                isCollapsed = !isCollapsed;\n                sidebar.classList.toggle('collapsed');\n                mainContent.classList.toggle('expanded');\n                toggleIcon.className = isCollapsed ? 'bi bi-chevron-right' : 'bi bi-chevron-left';\n                \n                // Close all dropdowns when collapsing\n                if (isCollapsed) {\n                    document.querySelectorAll('.submenu.show').forEach(submenu => {\n                        submenu.classList.remove('show');\n                    });\n                    document.querySelectorAll('.menu-arrow.rotated').forEach(arrow => {\n                        arrow.classList.remove('rotated');\n                    });\n                }\n            }\n        }\n\n        toggleBtn.addEventListener('click', toggleSidebar);\n        mobileOverlay.addEventListener('click', toggleSidebar);\n\n        // Dropdown functionality\n        document.querySelectorAll('[data-toggle]').forEach(link => {\n            link.addEventListener('click', function(e) {\n                e.preventDefault();\n                \n                if (isCollapsed && !isMobile) return;\n                \n                const target = this.getAttribute('data-toggle');\n                const submenu = document.getElementById(target + '-submenu');\n                const arrow = this.querySelector('.menu-arrow');\n                \n                // Close other dropdowns\n                document.querySelectorAll('.submenu.show').forEach(otherSubmenu => {\n                    if (otherSubmenu !== submenu) {\n                        otherSubmenu.classList.remove('show');\n                    }\n                });\n                \n                document.querySelectorAll('.menu-arrow.rotated').forEach(otherArrow => {\n                    if (otherArrow !== arrow) {\n                        otherArrow.classList.remove('rotated');\n                    }\n                });\n                \n                // Toggle current dropdown\n                submenu.classList.toggle('show');\n                arrow.classList.toggle('rotated');\n                \n                // Set active state\n                document.querySelectorAll('.menu-link.active').forEach(activeLink => {\n                    activeLink.classList.remove('active');\n                });\n                this.classList.add('active');\n            });\n        });\n\n        // User menu functionality\n        const userProfile = document.getElementById('userProfile');\n        const userMenu = document.getElementById('userMenu');\n        \n        userProfile.addEventListener('click', function(e) {\n            e.stopPropagation();\n            userMenu.classList.toggle('show');\n        });\n\n        // Close user menu when clicking outside\n        document.addEventListener('click', function() {\n            userMenu.classList.remove('show');\n        });\n\n        // Password toggle functionality\n        function togglePassword(fieldId) {\n            const field = document.getElementById(fieldId);\n            const icon = document.getElementById(fieldId + '_icon');\n            \n            if (field.type === 'password') {\n                field.type = 'text';\n                icon.className = 'bi bi-eye-slash';\n            } else {\n                field.type = 'password';\n                icon.className = 'bi bi-eye';\n            }\n        }\n\n        // Form validation\n        document.getElementById('profileForm').addEventListener('submit', function(e) {\n            const newPassword = document.getElementById('new_password').value;\n            const confirmPassword = document.getElementById('confirm_password').value;\n            const currentPassword = document.getElementById('current_password').value;\n            \n            // Only validate password if user is trying to change it\n            if (newPassword || confirmPassword) {\n                if (!currentPassword) {\n                    e.prevent"
  },
  {
    "tipo": "externo",
    "src": "https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
  },
  {
    "tipo": "inline",
    "index": 1,
    "conteudo": "\n        const app = {\n            selectMode: false,\n            selectedLogs: [],\n            deleteId: null,\n            activeFilter: null,\n            filters: {  data_inicio: '',\n                data_fim: '',\n                usuario: '',\n                empresa: '',\n                tipo: '',\n                descricao: '' },\n            isSuperuser: 'false',\n            \n            // Propriedades para guardar as inst√¢ncias dos modais\n            deleteModalInstance: null,\n            bulkModalInstance: null,\n\n            init() {\n                // 1. Instanciar os modais do Bootstrap\n                const deleteModalEl = document.getElementById('deleteModal');\n                if (deleteModalEl) {\n                    this.deleteModalInstance = new bootstrap.Modal(deleteModalEl);\n                }\n                \n                const bulkModalEl = document.getElementById('bulkDeleteModal');\n                if (bulkModalEl) {\n                    this.bulkModalInstance = new bootstrap.Modal(bulkModalEl);\n                }\n\n                this.loadFiltersFromURL();\n                this.setupEventListeners();\n                this.updateFilterIcons();\n            },\n\n            setupEventListeners() {\n                // Fechar dropdowns ao clicar fora\n                document.addEventListener('click', (e) => {\n                    if (!e.target.closest('.filter-icon') && !e.target.closest('.filter-dropdown')) {\n                        this.closeAllDropdowns();\n                    }\n                });\n                // Habilitar/desabilitar bot√£o de exclus√£o em massa\n                const bulkConfirm = document.getElementById('bulkDeleteConfirm');\n                if (bulkConfirm) {\n                    bulkConfirm.addEventListener('change', (e) => {\n                        document.getElementById('btnConfirmBulkDelete').disabled = !e.target.checked;\n                    });\n                }\n            },\n\n            loadFiltersFromURL() {\n                const urlParams = new URLSearchParams(window.location.search);\n                this.filters.data_inicio = urlParams.get('data_inicio') || '';\n                this.filters.data_fim = urlParams.get('data_fim') || '';\n                this.filters.usuario = urlParams.get('usuario') || '';\n                this.filters.empresa = urlParams.get('empresa') || '';\n                this.filters.tipo = urlParams.get('tipo') || '';\n                this.filters.descricao = urlParams.get('descricao') || '';\n\n                // Preencher inputs\n                const dataInicio = document.getElementById('dataInicio');\n                const dataFim = document.getElementById('dataFim');\n                if (dataInicio) dataInicio.value = this.filters.data_inicio;\n                if (dataFim) dataFim.value = this.filters.data_fim;\n                \n                const inputUsuario = document.getElementById('inputUsuario');\n                const inputEmpresa = document.getElementById('inputEmpresa');\n                const inputTipo = document.getElementById('inputTipo');\n                const inputDescricao = document.getElementById('inputDescricao');\n                \n                if (inputUsuario) inputUsuario.value = this.filters.usuario;\n                if (inputEmpresa) inputEmpresa.value = this.filters.empresa;\n                if (inputTipo) inputTipo.value = this.filters.tipo;\n                if (inputDescricao) inputDescricao.value = this.filters.descricao;\n            },\n\n            toggleFilter(filterName) {\n                const filterMap = {\n                    'data': 'Data',\n                    'usuario': 'Usuario',\n                    'empresa': 'Empresa',\n                    'tipo': 'Tipo',\n                    'descricao': 'Descricao'\n                };\n                \n                const dropdown = document.getElementById(`filter${filterMap[filterName]}`);\n                \n                if (this.activeFilter === filterName) {\n                    dropdown.classList.remove('active');\n                    this.activeFilter = null;\n                } else {\n                    this.closeAllDropdowns();\n                    dropdown.classList.add('active');\n                    this.activeFilter = filterName;\n                }\n            },\n\n            closeAllDropdowns() {\n                document.querySelectorAll('.filter-dropdown').forEach(dropdown => {\n                    dropdown.classList.remove('active');\n                });\n                this.activeFilter = null;\n            },\n\n            applyFilter() {\n                // Coletar valores dos inputs\n                const dataInicio = document.getElementById('dataInicio');\n                const dataFim = document.getElementById('dataFim');\n                const inputUsuario = document.getElementById('inputUsuario');\n                const inputEmpresa = document.getElementById('inputEmpresa');\n                const inputTipo = document.getElementById('inputTipo');\n                const inputDesc"
  },
  {
    "tipo": "inline",
    "index": 2,
    "conteudo": "\n        // --- 1. L√≥gica para carregar Toasts na inicializa√ß√£o ---\n        //const toastElList = [].slice.call(document.querySelectorAll('.toast'));\n        //const toastList = toastElList.map(function(toastEl) {\n            // Cria uma inst√¢ncia do Toast e a exibe\n        //    const toast = new bootstrap.Toast(toastEl);\n        //    toast.show();\n        //    return toast;\n        //});\n\n        // Sidebar functionality\n        const sidebar = document.getElementById('sidebar');\n        const mainContent = document.getElementById('mainContent');\n        const toggleBtn = document.getElementById('toggleSidebar');\n        const toggleIcon = document.getElementById('toggleIcon');\n        const mobileOverlay = document.getElementById('mobileOverlay');\n        \n        let isCollapsed = false;\n        let isMobile = window.innerWidth <= 768;\n\n        // Toggle sidebar\n        function toggleSidebar() {\n            if (isMobile) {\n                sidebar.classList.toggle('show');\n                mobileOverlay.classList.toggle('show');\n            } else {\n                isCollapsed = !isCollapsed;\n                sidebar.classList.toggle('collapsed');\n                mainContent.classList.toggle('expanded');\n                toggleIcon.className = isCollapsed ? 'bi bi-chevron-right' : 'bi bi-chevron-left';\n                \n                // Close all dropdowns when collapsing\n                if (isCollapsed) {\n                    document.querySelectorAll('.submenu.show').forEach(submenu => {\n                        submenu.classList.remove('show');\n                    });\n                    document.querySelectorAll('.menu-arrow.rotated').forEach(arrow => {\n                        arrow.classList.remove('rotated');\n                    });\n                }\n            }\n        }\n\n        toggleBtn.addEventListener('click', toggleSidebar);\n        mobileOverlay.addEventListener('click', toggleSidebar);\n\n        // Dropdown functionality\n        document.querySelectorAll('[data-toggle]').forEach(link => {\n            link.addEventListener('click', function(e) {\n                e.preventDefault();\n                \n                if (isCollapsed && !isMobile) return;\n                \n                const target = this.getAttribute('data-toggle');\n                const submenu = document.getElementById(target + '-submenu');\n                const arrow = this.querySelector('.menu-arrow');\n                \n                // Close other dropdowns\n                document.querySelectorAll('.submenu.show').forEach(otherSubmenu => {\n                    if (otherSubmenu !== submenu) {\n                        otherSubmenu.classList.remove('show');\n                    }\n                });\n                \n                document.querySelectorAll('.menu-arrow.rotated').forEach(otherArrow => {\n                    if (otherArrow !== arrow) {\n                        otherArrow.classList.remove('rotated');\n                    }\n                });\n                \n                // Toggle current dropdown\n                submenu.classList.toggle('show');\n                arrow.classList.toggle('rotated');\n                \n                // Set active state\n                document.querySelectorAll('.menu-link.active').forEach(activeLink => {\n                    activeLink.classList.remove('active');\n                });\n                this.classList.add('active');\n            });\n        });\n\n        // User menu functionality\n        const userProfile = document.getElementById('userProfile');\n        const userMenu = document.getElementById('userMenu');\n        \n        userProfile.addEventListener('click', function(e) {\n            e.stopPropagation();\n            userMenu.classList.toggle('show');\n        });\n\n        // Close user menu when clicking outside\n        document.addEventListener('click', function() {\n            userMenu.classList.remove('show');\n        });\n\n        // Password toggle functionality\n        function togglePassword(fieldId) {\n            const field = document.getElementById(fieldId);\n            const icon = document.getElementById(fieldId + '_icon');\n            \n            if (field.type === 'password') {\n                field.type = 'text';\n                icon.className = 'bi bi-eye-slash';\n            } else {\n                field.type = 'password';\n                icon.className = 'bi bi-eye';\n            }\n        }\n\n        // Form validation\n        document.getElementById('profileForm').addEventListener('submit', function(e) {\n            const newPassword = document.getElementById('new_password').value;\n            const confirmPassword = document.getElementById('confirm_password').value;\n            const currentPassword = document.getElementById('current_password').value;\n            \n            // Only validate password if user is trying to change it\n            if (newPassword || confirmPassword) {\n                if (!currentPassword) {\n                    e.prevent"
  },
  {
    "tipo": "externo",
    "src": "https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
  },
  {
    "tipo": "inline",
    "index": 1,
    "conteudo": "\n        const app = {\n            selectMode: false,\n            selectedLogs: [],\n            deleteId: null,\n            activeFilter: null,\n            filters: {  data_inicio: '',\n                data_fim: '',\n                usuario: '',\n                empresa: '',\n                tipo: '',\n                descricao: '' },\n            isSuperuser: 'false',\n            \n            // Propriedades para guardar as inst√¢ncias dos modais\n            deleteModalInstance: null,\n            bulkModalInstance: null,\n\n            init() {\n                // 1. Instanciar os modais do Bootstrap\n                const deleteModalEl = document.getElementById('deleteModal');\n                if (deleteModalEl) {\n                    this.deleteModalInstance = new bootstrap.Modal(deleteModalEl);\n                }\n                \n                const bulkModalEl = document.getElementById('bulkDeleteModal');\n                if (bulkModalEl) {\n                    this.bulkModalInstance = new bootstrap.Modal(bulkModalEl);\n                }\n\n                this.loadFiltersFromURL();\n                this.setupEventListeners();\n                this.updateFilterIcons();\n            },\n\n            setupEventListeners() {\n                // Fechar dropdowns ao clicar fora\n                document.addEventListener('click', (e) => {\n                    if (!e.target.closest('.filter-icon') && !e.target.closest('.filter-dropdown')) {\n                        this.closeAllDropdowns();\n                    }\n                });\n                // Habilitar/desabilitar bot√£o de exclus√£o em massa\n                const bulkConfirm = document.getElementById('bulkDeleteConfirm');\n                if (bulkConfirm) {\n                    bulkConfirm.addEventListener('change', (e) => {\n                        document.getElementById('btnConfirmBulkDelete').disabled = !e.target.checked;\n                    });\n                }\n            },\n\n            loadFiltersFromURL() {\n                const urlParams = new URLSearchParams(window.location.search);\n                this.filters.data_inicio = urlParams.get('data_inicio') || '';\n                this.filters.data_fim = urlParams.get('data_fim') || '';\n                this.filters.usuario = urlParams.get('usuario') || '';\n                this.filters.empresa = urlParams.get('empresa') || '';\n                this.filters.tipo = urlParams.get('tipo') || '';\n                this.filters.descricao = urlParams.get('descricao') || '';\n\n                // Preencher inputs\n                const dataInicio = document.getElementById('dataInicio');\n                const dataFim = document.getElementById('dataFim');\n                if (dataInicio) dataInicio.value = this.filters.data_inicio;\n                if (dataFim) dataFim.value = this.filters.data_fim;\n                \n                const inputUsuario = document.getElementById('inputUsuario');\n                const inputEmpresa = document.getElementById('inputEmpresa');\n                const inputTipo = document.getElementById('inputTipo');\n                const inputDescricao = document.getElementById('inputDescricao');\n                \n                if (inputUsuario) inputUsuario.value = this.filters.usuario;\n                if (inputEmpresa) inputEmpresa.value = this.filters.empresa;\n                if (inputTipo) inputTipo.value = this.filters.tipo;\n                if (inputDescricao) inputDescricao.value = this.filters.descricao;\n            },\n\n            toggleFilter(filterName) {\n                const filterMap = {\n                    'data': 'Data',\n                    'usuario': 'Usuario',\n                    'empresa': 'Empresa',\n                    'tipo': 'Tipo',\n                    'descricao': 'Descricao'\n                };\n                \n                const dropdown = document.getElementById(`filter${filterMap[filterName]}`);\n                \n                if (this.activeFilter === filterName) {\n                    dropdown.classList.remove('active');\n                    this.activeFilter = null;\n                } else {\n                    this.closeAllDropdowns();\n                    dropdown.classList.add('active');\n                    this.activeFilter = filterName;\n                }\n            },\n\n            closeAllDropdowns() {\n                document.querySelectorAll('.filter-dropdown').forEach(dropdown => {\n                    dropdown.classList.remove('active');\n                });\n                this.activeFilter = null;\n            },\n\n            applyFilter() {\n                // Coletar valores dos inputs\n                const dataInicio = document.getElementById('dataInicio');\n                const dataFim = document.getElementById('dataFim');\n                const inputUsuario = document.getElementById('inputUsuario');\n                const inputEmpresa = document.getElementById('inputEmpresa');\n                const inputTipo = document.getElementById('inputTipo');\n                const inputDesc"
  },
  {
    "tipo": "inline",
    "index": 2,
    "conteudo": "\n        // --- 1. L√≥gica para carregar Toasts na inicializa√ß√£o ---\n        //const toastElList = [].slice.call(document.querySelectorAll('.toast'));\n        //const toastList = toastElList.map(function(toastEl) {\n            // Cria uma inst√¢ncia do Toast e a exibe\n        //    const toast = new bootstrap.Toast(toastEl);\n        //    toast.show();\n        //    return toast;\n        //});\n\n        // Sidebar functionality\n        const sidebar = document.getElementById('sidebar');\n        const mainContent = document.getElementById('mainContent');\n        const toggleBtn = document.getElementById('toggleSidebar');\n        const toggleIcon = document.getElementById('toggleIcon');\n        const mobileOverlay = document.getElementById('mobileOverlay');\n        \n        let isCollapsed = false;\n        let isMobile = window.innerWidth <= 768;\n\n        // Toggle sidebar\n        function toggleSidebar() {\n            if (isMobile) {\n                sidebar.classList.toggle('show');\n                mobileOverlay.classList.toggle('show');\n            } else {\n                isCollapsed = !isCollapsed;\n                sidebar.classList.toggle('collapsed');\n                mainContent.classList.toggle('expanded');\n                toggleIcon.className = isCollapsed ? 'bi bi-chevron-right' : 'bi bi-chevron-left';\n                \n                // Close all dropdowns when collapsing\n                if (isCollapsed) {\n                    document.querySelectorAll('.submenu.show').forEach(submenu => {\n                        submenu.classList.remove('show');\n                    });\n                    document.querySelectorAll('.menu-arrow.rotated').forEach(arrow => {\n                        arrow.classList.remove('rotated');\n                    });\n                }\n            }\n        }\n\n        toggleBtn.addEventListener('click', toggleSidebar);\n        mobileOverlay.addEventListener('click', toggleSidebar);\n\n        // Dropdown functionality\n        document.querySelectorAll('[data-toggle]').forEach(link => {\n            link.addEventListener('click', function(e) {\n                e.preventDefault();\n                \n                if (isCollapsed && !isMobile) return;\n                \n                const target = this.getAttribute('data-toggle');\n                const submenu = document.getElementById(target + '-submenu');\n                const arrow = this.querySelector('.menu-arrow');\n                \n                // Close other dropdowns\n                document.querySelectorAll('.submenu.show').forEach(otherSubmenu => {\n                    if (otherSubmenu !== submenu) {\n                        otherSubmenu.classList.remove('show');\n                    }\n                });\n                \n                document.querySelectorAll('.menu-arrow.rotated').forEach(otherArrow => {\n                    if (otherArrow !== arrow) {\n                        otherArrow.classList.remove('rotated');\n                    }\n                });\n                \n                // Toggle current dropdown\n                submenu.classList.toggle('show');\n                arrow.classList.toggle('rotated');\n                \n                // Set active state\n                document.querySelectorAll('.menu-link.active').forEach(activeLink => {\n                    activeLink.classList.remove('active');\n                });\n                this.classList.add('active');\n            });\n        });\n\n        // User menu functionality\n        const userProfile = document.getElementById('userProfile');\n        const userMenu = document.getElementById('userMenu');\n        \n        userProfile.addEventListener('click', function(e) {\n            e.stopPropagation();\n            userMenu.classList.toggle('show');\n        });\n\n        // Close user menu when clicking outside\n        document.addEventListener('click', function() {\n            userMenu.classList.remove('show');\n        });\n\n        // Password toggle functionality\n        function togglePassword(fieldId) {\n            const field = document.getElementById(fieldId);\n            const icon = document.getElementById(fieldId + '_icon');\n            \n            if (field.type === 'password') {\n                field.type = 'text';\n                icon.className = 'bi bi-eye-slash';\n            } else {\n                field.type = 'password';\n                icon.className = 'bi bi-eye';\n            }\n        }\n\n        // Form validation\n        document.getElementById('profileForm').addEventListener('submit', function(e) {\n            const newPassword = document.getElementById('new_password').value;\n            const confirmPassword = document.getElementById('confirm_password').value;\n            const currentPassword = document.getElementById('current_password').value;\n            \n            // Only validate password if user is trying to change it\n            if (newPassword || confirmPassword) {\n                if (!currentPassword) {\n                    e.prevent"
  }
]